@model FOS.Shared.ReportsInputData


@{
    ViewBag.Title = "Painter";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

@*<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>*@
<script src="~/Scripts/jquery.sumoselect.js" type="text/javascript"></script>
<link href="~/Content/dropdownliststyle.css" rel="stylesheet" type="text/css" />
<!-- BEGIN PAGE HEADER-->
<div class="row-fluid">
    <div class="span12">

        <h3 class="page-title"></h3>
        <ul class="breadcrumb">
            <li><a href="#">Reports</a>
            <span class="divider">/</span>
            </li>
            <li>
                <a href="#">Test Report</a>
            </li>
        </ul>
    </div>
</div>
<!-- END PAGE HEADER-->

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="widget green" style="height: 298px;">
                    <div class="widget-title">
                        <h4>Reports Perameter</h4>
                        <span class="tools">
                        </span>
                    </div>
                    <div class="widget-body" style="height: 270px;">

                        @*<div class="span12">*@

                            <div class="span6">

                            <div class="control-group" style="margin-bottom: 14px;">
                           <label class="control-label">Starting</label>
                           <div class="controls">
                              <input class="text-box single-line" id="StartingDate1" name="StartingDate1" style="height: 22px; width: 202px; margin-bottom: 0px;">
                           </div>
                        </div>
                            

                            <div class="control-group">
                                    <label class="control-label">Territory:</label>
                                    <div class="controls">
                                       @*@Html.DropDownListFor(model => model.TID, new SelectList(Model.Territories, "ID", "TeritoryName"), new {@multiple="multiple", @class = "SlectBox" })*@
                                        @Html.DropDownListFor(model => model.TID, new SelectList(Model.Territories, "ID", "TeritoryName"), "---Select ---", new {})
                                    </div>
                                 </div>  
                           </div>


                            @*<div class="span6">*@

                                <div class="control-group" style="margin-bottom: 14px;">
                           <label class="control-label">Ending</label>
                           <div class="controls">
                              <input class="text-box single-line" id="EndingDate1" name="EndingDate1"  style="height: 22px; width: 202px; margin-bottom: 0px;">
                           </div>
                        </div>

                                <span style="font-size: 10px;margin-left: 180px;color: #cc514f;"></span>
                            <div class="control-group">

                                <label class="control-label">City:</label>
                                <div class="controls">
                                    @Html.DropDownListFor(model => model.CID, new SelectList(Model.PainterCityNames, "ID", "CityName"), new { @multiple="multiple", @class = "pCheckBox" })
                                @*@Html.DropDownListFor(model => model.CID, Model.PainterCityNames, "---Select Product---", new { @multiple="multiple", @class = "SlectBox" })*@
                                </div>
                            </div>
                        
                               
                                 <div class="control-group" style="">
                                    <div class="form-actions" style="padding-left: 238px;">
                                        <button type="submit" id="btnNew" value="Create" class="btn btn-primary">
                                            <i class="icon-ok icon-white" style="padding-right:8px"></i><span id="create">Create</span>
                                        </button>
                                        <button type="button" id="btnRefresh" class="btn btn-info"><i class="icon-ban-circle icon-white" style="padding-right:8px"></i>Reset</button>
                                    </div>
                                </div>
                            

                                @*</div>*@

                             @*</div>*@

                        <!-- END FORM-->
                        
                    </div>
                </div>
    <div id="painters" class="" style="width: 108%; height: 440px;"></div>
                    
    @*<div class='span3 scroll' style='margin:0px;margin-left: 0px;'>
        <input checked id='painter88' data-id='88' class='pCheckBox' name='painter[]' onchange='painterSelected(this)' type='checkbox' style='margin: -1px 0 0;'>
        <span class='lbl' style='font-size: 11px;margin-left: 5px;color: #000000;'>Wah Cantt</span>
        <p style='font-size:9px;' id='cityName'>Wah Cantt</p>

    </div>*@
}



<script src="~/Scripts/js/sugar.min.js"></script>
<script src="@Url.Content("~/Scripts/js/jquery.fileDownload.js")"></script>
<script>

    function LoadPainters(TID) {
        try {
            $.ajax({
                type: "POST",
                data: { TID: TID },
                url: "@Url.Action("getCities", "Painter")",
                success: function (json) {

                    var $el = $("#painters");
                    $el.empty(); // remove old options
                    $("#painters").append(json.Response);

                    //sPainters = [];
                    //for (i = 0 ; i < json.PainterIDs.length ; i++) {
                    //    sPainters.push(json.PainterIDs[i]);
                    //}

                    $.each(json.Response, function (value, key) {

                        if (key.Selected == true) {
                            $("#painter" + key.ID + "").attr("checked", true);

                        }
                        else { $("#painter" + key.ID + "").attr("checked", false); }
                        //sPainters.push(key.ID);
                    });


                },
                beforeSend: function () {
                    $("#progress").show();
                },
                complete: function () {
                    $("#progress").hide();
                },
                error: function () {
                }

            });
        } catch (e) {
            alert(e);

        }
    }

    $("#TID").on("change", function (e) {
        //LoadPainters($(this).val());
        @*$.ajax({
            type: "POST",
            data: { TID: TID },
            url: "@Url.Action("getCities", "Painter")",
                success: function (json) {

                    var $el = $("#painters");
                    $el.empty(); // remove old options
                    $("#painters").append(json.Response);

                    //sPainters = [];
                    //for (i = 0 ; i < json.PainterIDs.length ; i++) {
                    //    sPainters.push(json.PainterIDs[i]);
                    //}

                    $.each(json.Response, function (value, key) {

                        if (key.Selected == true) {
                            $("#painter" + key.ID + "").attr("checked", true);

                        }
                        else { $("#painter" + key.ID + "").attr("checked", false); }
                        //sPainters.push(key.ID);
                    });


                },
                beforeSend: function () {
                    $("#progress").show();
                },
                complete: function () {
                    $("#progress").hide();
                },
                error: function () {
                }

        });*@
        var $TID = $(this).val();
        var $citylist = $("#CID");
        $.ajax({
            url: '@Url.Action("getCities", "Painter")',
                type: "post",
                dataType: 'json',
                data: {
                    TID: $TID,
                },
                success: function (json) {
                    //$citylist.addClass("SlectBox");
                    var $el = $("#painters");
                    $el.empty(); // remove old options
                    $("#painters").append(json.Response);
                    //$.each(json.Response, function (value, key) {

                        //if (key.Selected == true) {
                        //    $("#painter" + key.ID + "").attr("checked", true);

                        //}
                        //else { $("#painter" + key.ID + "").attr("checked", false); }
                        //sPainters.push(key.ID);
                    //});

                    //$citylist.filter(function () { return $($citylist).find('option[value!=""]').remove() });
                    //$.each(data, function (k, v) {
                    //    $("<option/>", { value: v.Value, text: v.Text }).appendTo($citylist);
                    //});
                    //$citylist.addClass("SlectBox");//.class("SlectBox");
                    alert("success");
                    //$citylist.empty(); // remove old options
                    //$.each(json, function (value, key) {

                    //    $citylist.append($("<option></option>")
                    //            .attr("value", key.ID).text(key.Name));
                    //});
                },
                error: function (jxhr) {
                    alert("error");
                    if (typeof console != 'undefined') {
                        console.log(jxhr.responseText);
                    }
                }
            });
   });

    $('#btnNew').click(function () {
        var selected = $("#CID option:selected");
        var message = "";
        selected.each(function () {
            // message += $(this).text() + " " + $(this).val() + "\n";
            message += $(this).val() + ",";
        });
        var TID = $("#TID").val();
        var sdate = $("#StartingDate1").val();
        var edate = $("#EndingDate1").val();
        alert(TID);
        alert(sdate);
        alert(edate);
        alert(message);
        $.ajax({
            url: '@Url.Action("getData", "Painter")',
            type: "post",
            dataType: 'json',
            data: {
                cities: message
            },
            success: function (data) {
                alert("success");
            },
            error: function (jxhr) {
                alert("error");
                if (typeof console != 'undefined') {
                    console.log(jxhr.responseText);
                }
            }
        });
    });
    //var a = [];
    var sPainters = [];

    function painterSelected(obj) {

      
        var painterID = $(obj).attr("data-id");
        var i = findPainter(sPainters, painterID);

        if (obj.checked && i == -1)
        {
            sPainters.push(painterID);
        }

        if (!obj.checked && i > -1)
        {
            sPainters.splice(i,1); //('"'+painterID+'"');
        }
        console.log(sPainters);
    }

    function findPainter(arr, val)
    {
        for (i = 0; i < arr.length ; i++)
        {
            if (arr[i] == val)
            {
                return i;
            }
        }
        return -1;
    }

    $(function () {
        $('#form0').submit(function () {

            $("#City").val($("#PainterCityID").find("option:selected").text());
            $("#SelectedPainters").val(sPainters);
        });

        


        //$(".pCheckBox input[name='painter[]']").bind().change(function () {
        //    alert(this.attr("data-id"));
        //});


    });


    function LoadPainters(CityName) {
        try {
            $.ajax({
                type: "POST",
                data: {
                    //RegionalHeadID: $("#RegionalHeadID").val(), SaleOfficerID: $("#SaleOfficerID").val(), RetailerID: $("#RetailerID").val(), CityName: CityName
                },
                url: "@Url.Action("LoadCitiesEdit", "Painter")",
                success: function (json) {
                    
                    var $el = $("#painters");
                    $el.empty(); // remove old options
                    $("#painters").append(json.Response);

                    sPainters = [];
                    for (i = 0 ; i < json.PainterIDs.length ; i++)
                    {
                        sPainters.push(json.PainterIDs[i]);
                    }
                    
                    $.each(json.Response, function (value, key) {

                        if (key.Selected == true) {
                            $("#painter" + key.ID + "").attr("checked", true);
                           
                        }
                        else { $("#painter" + key.ID + "").attr("checked", false); }
                        //sPainters.push(key.ID);
                    });


                },
                beforeSend: function () {
                    $("#progress").show();
                },
                complete: function () {
                    $("#progress").hide();
                },
                error: function () {
                }

            });
        } catch (e) {
            alert(e);

        }
    }

    function LoadRegionalHead() {

        var RegionalHeadType = $("#Type").val();

        $.ajax({
            type: "POST",
            data: { RegionalHeadType: RegionalHeadType },
            url: "@Url.Action("GetRegionalHeadAccordingToType", "SaleOfficer")",
            dataType: 'json',
            success: function (json) {

                var $el = $("#RegionalHeadID");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {

                    $el.append($("<option></option>")
                            .attr("value", key.ID).text(key.Name));
                });
                $("#RegionalHeadID").trigger("change");
            }

        });
    }

    $(document).ready(function () {
        // $("#liPainter,#liManagePainter").addClass("active");
        //window.asd = $('.SlectBox').SumoSelect({ csvDispCount: 4 });
        //alert("Test");
        $('input[name=StartingDate1]').css({ "height": "22px", "width": "202px", "margin-bottom": "0px" });
        $('input[name=StartingDate1]').datepicker({ dateFormat: "dd-MM-yy" });
        $("input[name=StartingDate1]").trigger('change');

        $('input[name=EndingDate1]').css({ "height": "22px", "width": "202px", "margin-bottom": "0px" });
        $('input[name=EndingDate1]').datepicker({ dateFormat: "dd-MM-yy" });
        $("input[name=EndingDate1]").trigger('change');
        window.asd = $('.SlectBox').SumoSelect({ csvDispCount: 4 });
        $("#TID").change(function () {
           // LoadPainters($(this).find("option:selected").text());
        });
        @*$.ajax({
            type: "POST",
            url: "@Url.Action("PaintersInfo", "Painter")",
                            data: {},
                            success: function (json) {

                                if (json != null) {
                                    $("#totalpainters").html(json.TotalNoOfPainters);
                                    $("#usedpainters").html(json.UsedPainters);
                                    $("#freepainters").html(json.FreePainters);
                                    $("#cities").html(json.Cities);
                                }
                            }
         });

        var WriteCheck = "0";

        //GenerateDetailGrid();
        $("#RetailerID").trigger('change');


       // LoadPainters($("#PainterCityID").find("option:selected").text());

        $("#PainterCityID").change(function () {
            LoadPainters($(this).find("option:selected").text());
        });

        if (WriteCheck == "@HttpContext.Current.Session["WriteCheck"]") {
            // $("#btnNew").css("display", "none");
            $("#btnNew").attr("disabled", true);
        }
        else {
        }


        $("#RegionalHeadID").change(function () {

            $("#HiddenRegionalHeadID").val($(this).val())
            LoadSalesOfficer($(this).val());
            //var dt = $('#datatab').DataTable();
            //dt.ajax.reload();

        });

        $("#SaleOfficerID").change(function () {

            LoadRetailers($(this).val());
            //var dt = $('#datatab').DataTable();
            //dt.ajax.reload();

        });


        $("#RetailerID").change(function () {
            //var CityName = $("#PainterCityID").text();
            //LoadPainters(CityName);
            $("#PainterCityID").trigger("change");
        });


        function LoadSalesOfficer(RegionalHeadID) {

            $.ajax({
                type: "POST",
                data: { RegionalHeadID: RegionalHeadID },
                url: "@Url.Action("GetAllSaleOfficerListRelatedToDealer", "Job")",
                success: function (json) {

                    var $el = $("#SaleOfficerID");
                    $el.empty(); // remove old options
                    $.each(json, function (value, key) {
                        $el.append($("<option></option>").val(key.SaleOfficerID).text(key.SaleOfficerName));
                    });

                    $('#SaleOfficerID').trigger("chosen:update");
                    $('#SaleOfficerID').trigger("change");
                }

            });

        }

        function LoadRetailers(SOID) {
            var $e2 = $("#RetailerID");
            if (SOID == null)
            { $e2.empty(); }
            else {
                $.ajax({
                    type: "POST",
                    data: { SaleOfficerID: SOID },
                    url: "@Url.Action("LoadRetailersRelatedToSaleOfficer", "Painter")",
                     success: function (json) {
                         $e2.empty();
                         $.each(json, function (value, key) {
                             $e2.append($("<option></option>").val(key.ID).text(key.Name).attr("data-cityname", key.CItyName));
                         });
                     }
                 });
             }
         }*@
        /*
        $("#btnRefresh").click(function () {
            LoadPainters($("#PainterCityID").find("option:selected").text());
            ClearForm();
        });

        $("#btnRefresh").trigger('click');
        $("#PainterCityID").trigger('change');*/

    });


     function ClearForm() {
         $('#ID').val(0);
         $('#Title').val('');
         $('#create').text('Create');
         $("#RegionalHeadID").trigger("change");
         $("#RegionalHeadID").trigger("chosen:update");
         $("#SelectedPainters").val("");
     }

     function OnSuccess(response) {
         if (response == "1") {
             alertify.success("Association Saved Successfully");
             $('#create').text('Create');
             LoadPainters($("#PainterCityID").find("option:selected").text());
             ClearForm();
         }
         else if (response == "2") {
             alertify.error("Please Select Any Painter For Association");
         }
         else if (response == "3") {
             alertify.error("Please Select Any Painter For Association");
         }
         else if (response == "0") {
             alertify.error("Unable To Save Association.");
         }
         else {
             alertify.error(response);
         }

     }

     function OnFailure(response) {
         if (response.status == 422) {
             var errors = JSON.parse(response.responseText);
             alertify.error(errors.errors);
         }
         else {
             alertify.error(response);
         }
     }

</script>

